<!doctype html>
<html>

<head>
    <!-- meta data -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!--font-family-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&amp;subset=devanagari,latin-ext"
          rel="stylesheet">

    <!-- title of site -->
    <title>Sign up</title>

    <!-- For favicon png -->
    <link rel="shortcut icon" type="image/icon" href="assets/logo/favicon.png"/>

    <!--font-awesome.min.css-->
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">

    <!--animate.css-->
    <link rel="stylesheet" href="assets/css/animate.css">

    <!--bootstrap.min.css-->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">

    <!-- bootsnav -->
    <link rel="stylesheet" href="assets/css/bootsnav.css">

    <!--style.css-->
    <link rel="stylesheet" href="assets/css/style.css">

    <!--responsive.css-->
    <link rel="stylesheet" href="assets/css/responsive.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
<!--[if lte IE 9]>
<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade
    your browser</a> to improve your experience and security.</p>
<![endif]-->

<!-- signin end -->
<section class="signin signup">
    <div class="container">

        <div class="sign-content">
            <h2>sign up</h2>

            <div class="row">
                <div class="col-sm-12">
                    <div class="signin-form">
                        <form action="signin.html">

                            <div class="form-group">
                                <label for="signup_form_email">Email</label>
                                <input type="email" class="form-control" id="signup_form_email"
                                       placeholder="enter your email here">
                                <div class="alert alert-danger" id="email_alert" style="display: none"></div>

                            </div><!--/.form-group -->

                            <div class="form-group">
                                <label for="form_vercode">邮箱验证码</label>
                                <input type="text" class="form-control" id="form_vercode"
                                       placeholder=" Verification code">
                                <div class="alert alert-danger" id="vcode_alert" style="display: none"></div>

                            </div><!--/.form-group -->
                            <div class="form-group">
                                <div type="button" class="btn btn-block btn-primary" id="send"
                                     onclick="send_btn_click()">发送验证码
                                </div>
                                <div class="alert alert-success" id="send_vcode_alert" style="display: none"></div>

                            </div>


                            <div class="form-group">
                                <label for="signup_form_psw">password</label>
                                <input type="password" class="form-control" id="signup_form_psw" placeholder="Password">
                            </div><!--/.form-group -->
                            <div class="form-group">
                                <label for="signup_form_rpsw">retype password</label>
                                <input type="password" class="form-control" id="signup_form_rpsw"
                                       placeholder="Retype Password">
                                <div class="alert alert-danger" id="psw_alert" style="display: none"></div>

                            </div><!--/.form-group -->
                        </form><!--/form -->
                    </div><!--/.signin-form -->
                </div><!--/.col -->
            </div><!--/.row -->

            <div class="row">
                <div class="col-sm-12">
                    <div class="signin-password">
                        <div class="alert alert-success" id="request_result_alert" style="display: none"></div>
                    </div><!--/.signin-password -->
                </div><!--/.col -->
            </div><!--/.row -->


            <div class="row">
                <div class="col-sm-12">
                    <div class="signin-footer">
                        <button type="button" class="btn signin_btn" onclick="submit()">
                            sign up
                        </button>
                        <p>
                            already member ?
                            <a href="signin.html">sign in</a>
                        </p>
                    </div><!--/.signin-footer -->
                </div><!--/.col-->
            </div><!--/.row -->

        </div><!--/.sign-content -->


    </div><!--/.container -->

</section><!--/.signin -->

<!-- signin end -->

<!--footer copyright start -->
<footer class="footer-copyright">
    <div id="scroll-Top">
        <i class="fa fa-angle-double-up return-to-top" id="scroll-top" data-toggle="tooltip" data-placement="top"
           title="" data-original-title="Back to Top" aria-hidden="true"></i>
    </div><!--/.scroll-Top-->

</footer><!--/.hm-footer-copyright-->
<!--footer copyright  end -->


<!-- Include all js compiled plugins (below), or include individual files as needed -->

<script src="assets/js/jquery.js"></script>

<!--modernizr.min.js-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>

<!--bootstrap.min.js-->
<script src="assets/js/bootstrap.min.js"></script>

<!-- bootsnav js -->
<script src="assets/js/bootsnav.js"></script>

<!-- jquery.sticky.js -->
<script src="assets/js/jquery.sticky.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>


<!--Custom JS-->
<script src="assets/js/custom.js"></script>
<script src="js/config.js"></script>


<script>

    var send_btn = document.getElementById("send");
    var email_input = document.getElementById("signup_form_email");
    var wait_time = 60;
    var email_alert = document.getElementById("email_alert");
    var psw_alert = document.getElementById("psw_alert");
    var vcode_alert = document.getElementById("vcode_alert");
    var send_vcode_alert = document.getElementById("send_vcode_alert");

    var vcode_input = document.getElementById("form_vercode");

    var request_result_alert = document.getElementById("request_result_alert");


    var interval;


    function clock() {
        wait_time--;
        send_btn.innerText = wait_time.toString() + "s后重试";
        if (wait_time === 0) {
            window.clearInterval(interval);
            send_btn.innerText = "发送验证码";
            send_btn.setAttribute("class", "btn btn-block btn-primary");
            send_btn.disabled = false;
            wait_time = 60;

        }
    }


    function send_btn_click() {
        var email = email_input.value;
        email_alert.style.display = "none";
        send_vcode_alert.style.display = "none";

        if (email.trim() === "") {
            //alert(email_alert.innerText)
            email_alert.innerText = "邮箱不能为空";
            email_alert.style.display = "block";
            return;
        }

        if (!ischeckemail())
            return;
        send_btn.setAttribute("class", "btn btn-block btn-secondary");
        send_btn.setAttribute("disabled", "false");
        interval = self.setInterval("clock()", 1000);
        console.log(email);
        $.ajax({
            url: ip + ":9006/5",
            type: "POST",
            dataType: 'json',
            data: {'type': '1', 'email': email},

            success: function (res) {
                if (res['success'] === true) {
                    send_vcode_alert.setAttribute('class', "alert alert-success");
                    send_vcode_alert.innerText = "邮件发送成功，请注意检查邮箱";
                    send_vcode_alert.style.display = "block";
                } else {
                    send_vcode_alert.setAttribute('class', "alert alert-danger");
                    send_vcode_alert.innerText = res['msg'];
                    send_vcode_alert.style.display = "block";
                }
            }
        })


    }

    window.onload = function () {
        //alert('11');
    }


    function ischeckemail() {
        var email = email_input.value;
        if (email !== "") {
            var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;
            //调用正则验证test()函数
            isok = reg.test(email);
            if (!isok) {
                //alert("邮箱格式不正确，请重新输入！");
                email_alert.innerText = "邮箱格式不正确，请重新输入！";
                email_alert.style.display = "block";
                email_input.focus();
                return false;
            } else {
                return true;
            }
        }
    }

    function submit() {
        psw_alert.style.display = "none";
        var psw = document.getElementById("signup_form_psw").value.trim();
        var rpsw = document.getElementById("signup_form_rpsw").value.trim();
        var vcode = vcode_input.value.trim();
        var email = email_input.value.trim();

        if (email.trim() === "" || !ischeckemail(email)) {
            email_alert.innerText = "请输入正确的邮箱";
            email_alert.style.display = "block";
            return;
        } else {
            email_alert.style.display = "none";
        }

        if (vcode.trim() === "" || vcode.length !== 6) {
            vcode_alert.innerText = "请输入正确的验证码";
            vcode_alert.style.display = "block";
            return;
        } else {
            vcode_alert.style.display = "none";
        }

        if (psw.trim() === "") {
            psw_alert.innerText = "请输入密码";
            psw_alert.style.display = "block";
            return;
        }
        if (psw !== rpsw) {
            psw_alert.innerText = "两次密码输入不一致，请重新输入！";
            psw_alert.style.display = "block";
            rpsw.focus();
            return;
        } else {
            psw_alert.style.display = "none";
        }

        $.ajax({
            url: ip + ":9006/3",
            type: "POST",
            dataType: 'json',
            data: {'user': email, 'passwd': psw, 'vcode': vcode},

            success: function (res) {
                if (res['success'] === true) {
                    request_result_alert.setAttribute('class', "alert alert-success");
                    request_result_alert.innerText = "注册成功请返回登录";
                    request_result_alert.style.display = "block";
                } else {
                    request_result_alert.setAttribute('class', "alert alert-danger");
                    request_result_alert.innerText = "注册出现问题：" + res['msg'];
                    request_result_alert.style.display = "block";
                }
            }
        })

    }
</script>

</body>

</html>